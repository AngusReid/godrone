#!/usr/bin/env expect -f
set ip [lindex $argv 0]
set bin [lindex $argv 1]

spawn telnet $ip
expect -re .*#
send "touch /tmp/.norespawn\n"
expect -re .*#
send "killall -9 program.elf\n"
expect -re .*#
send "killall -9 $bin\n"
expect -re .*#
send "cd /data/video\n"
expect -re .*#
send "rm $bin\n"
expect -re .*#
send "mv $bin.next $bin\n"
expect -re .*#
send "chmod +x $bin\n"
expect -re .*#
send "gpio 181 -d ho 1\n"
expect -re .*#
send "GOGCTRACE=1 ./$bin\n"
set timeout -1
expect -re .*#
